CREATE EXTENSION IF NOT EXISTS "pgcrypto";

-- 1. Users Table
CREATE TABLE IF NOT EXISTS "users" (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  username VARCHAR(100) NOT NULL UNIQUE,
  email VARCHAR(255) NOT NULL UNIQUE,
  "passwordHash" VARCHAR(255) NOT NULL,
  role VARCHAR(10) CHECK (role IN ('admin', 'mentor', 'mentee')) NOT NULL,
  "createdAt" TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
  "updatedAt" TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- 2. Mentee Table
CREATE TABLE IF NOT EXISTS "mentee" (
  "menteeId" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  "userId" UUID NOT NULL UNIQUE REFERENCES "users" (id) ON DELETE CASCADE,
  "shortBio" VARCHAR(255) NOT NULL,
  "goals" VARCHAR(255) NOT NULL,
  "username" VARCHAR(255) NOT NULL,
  "createdAt" TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
  "updatedAt" TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- 3. Mentor Table
CREATE TABLE IF NOT EXISTS "mentor" (
  "mentorId" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  "userId" UUID NOT NULL UNIQUE REFERENCES "users" (id) ON DELETE CASCADE,
  "shortBio" VARCHAR(255) NOT NULL,
  "goals" VARCHAR(255) NOT NULL,
  "username" VARCHAR(255) NOT NULL,
  "createdAt" TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
  "updatedAt" TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- 4. Mentorship Request Table
CREATE TABLE IF NOT EXISTS "mentorship_request" (
  id SERIAL PRIMARY KEY,
  "mentorId" UUID NOT NULL REFERENCES "users" (id) ON DELETE CASCADE,
  "menteeId" UUID NOT NULL REFERENCES "users" (id) ON DELETE CASCADE,
  status VARCHAR(20) NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'accepted', 'rejected')),
  "createdAt" TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
  "updatedAt" TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- 5. Skills Table
CREATE TABLE IF NOT EXISTS "skills" (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255) NOT NULL UNIQUE
);

-- 6. User Skills Junction Table
CREATE TABLE IF NOT EXISTS "user_skills" (
  "userId" UUID NOT NULL REFERENCES "users" (id) ON DELETE CASCADE,
  "skillId" INTEGER NOT NULL REFERENCES "skills" (id) ON DELETE CASCADE,
  PRIMARY KEY ("userId", "skillId")
);